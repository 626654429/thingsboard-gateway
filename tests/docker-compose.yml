version: '3.5'
services:
  tb:
    image: "thingsboard/tb-postgres"
    ports:
      - "8080:9090"
      - "1883:1883"
      - "7070:7070"
      - "5683-5688:5683-5688/udp"
    environment:
      TB_QUEUE_TYPE: in-memory
    volumes:
      - tb-data:/data
      - tb-logs:/var/log/thingsboard
    network_mode: host
  gw:
    image: "tb-gateway"
    ports:
      - "5000:5000"
    environment:
      - host=tb
      - port=1883
      - accessToken=GatewayAccessToken
    volumes:
      - tb-gw-config:/thingsboard_gateway/config
      - tb-gw-logs:/thingsboard_gateway/logs
      - tb-gw-extensions:/thingsboard_gateway/extensions
    network_mode: host
  mqtt-broker:
    image: "thingsboard/tb-gw-mqtt-broker"
    ports:
      - "1884:1884"
    network_mode: host
  modbus-server:
    image: "thingsboard/tb-gw-modbus-server"
    ports:
      - "5021:5021"
    network_mode: host
  opcua-server:
    image: "thingsboard/tb-gw-opcua-server"
    ports:
      - "4840:4840"
    network_mode: host
volumes:
  tb-data:
    name: tb-data
  tb-logs:
    name: tb-logs
  tb-gw-config:
    name: tb-gw-config
  tb-gw-logs:
    name: tb-gw-logs
  tb-gw-extensions:
    name: tb-gw-extensions
